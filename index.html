<!DOCTYPE html>
<html>
<head>
    <base target="_top">
    <title>ê³ ê¸° êµ½ê¸° ë§ˆìŠ¤í„°</title>
    <!-- Tailwind CSSë¥¼ ì‚¬ìš©í•˜ì—¬ ìŠ¤íƒ€ì¼ë§í•©ë‹ˆë‹¤. -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* ì»¤ìŠ¤í…€ ê²Œì„ ìŠ¤íƒ€ì¼ */
        body {
            background-color: #f7fafc; /* Tailwind gray-50 */
            font-family: 'Inter', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
        }

        .game-container {
            max-width: 600px;
            width: 95%;
            background-color: white;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            transition: transform 0.3s ease;
        }

        .grill {
            height: 120px;
            background-color: #333; /* ìˆ¯ë¶ˆ ìƒ‰ */
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-top: 20px;
            position: relative;
            /* ìˆ¯ë¶ˆì˜ ê¹Šì´ê° í‘œí˜„ */
            box-shadow: inset 0 0 15px rgba(0, 0, 0, 0.5), 0 5px 10px rgba(100, 0, 0, 0.5);
            border: 4px solid #555;
        }

        .meat {
            width: 80px;
            height: 80px;
            background-color: #A0522D; /* ì´ˆê¸° ê³ ê¸° ìƒ‰ìƒ (ê°ˆìƒ‰ ê³„ì—´) */
            border-radius: 50%;
            /* ìƒ‰ìƒ ë³€í™”ì™€ ë’¤ì§‘ê¸° ì• ë‹ˆë©”ì´ì…˜ì„ ìœ„í•œ íŠ¸ëœì§€ì…˜ */
            transition: background-color 0.5s ease-out, transform 0.3s ease-out; 
            border: 3px solid #f0f0f0;
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.3);
            text-align: center;
            line-height: 80px;
            color: white;
            font-weight: bold;
            font-size: 10px;
            position: absolute;
        }
        
        /* ê³ ê¸° ë’¤ì§‘ê¸° ì• ë‹ˆë©”ì´ì…˜ (Yì¶• 180ë„ íšŒì „) */
        .flipped {
            transform: rotateY(180deg);
        }

        .doneness-bar {
            height: 20px;
            background-color: #e5e7eb;
            border-radius: 10px;
            overflow: hidden;
            margin-top: 20px;
        }

        .doneness-fill {
            height: 100%;
            width: 0%;
            background-color: #ef4444; /* ì´ˆê¸° ë¹¨ê°„ìƒ‰ */
            transition: width 0.1s linear, background-color 0.5s;
        }

        /* ë²„íŠ¼ í´ë¦­ íš¨ê³¼ */
        button {
            transition: all 0.1s;
            box-shadow: 0 4px #9ca3af;
        }

        button:active {
            transform: translateY(2px);
            box-shadow: 0 2px #9ca3af;
        }
    </style>
</head>
<body class="bg-gray-100">

<div id="app" class="game-container">
    <h1 class="text-3xl font-extrabold text-gray-800 mb-6 text-center">ğŸ¥© ê³ ê¸° êµ½ê¸° ë§ˆìŠ¤í„° ğŸ¥©</h1>

    <!-- ê²Œì„ ì •ë³´/ìš”ì²­ í‘œì‹œ ì˜ì—­ -->
    <div class="bg-blue-50 p-4 rounded-lg mb-6 border-2 border-blue-200">
        <p class="text-lg font-semibold text-blue-700">ì†ë‹˜ ìš”ì²­: <span id="target-doneness" class="text-xl font-bold"></span></p>
        <p class="text-sm text-gray-600 mt-2">ğŸ”¥ í˜„ì¬ ì ìˆ˜: <span id="current-score" class="font-bold text-red-600">0</span>ì </p>
    </div>

    <!-- ê³ ê¸° (Grill) ì˜ì—­ -->
    <div class="grill">
        <div id="meat" class="meat">ğŸ¥©</div>
    </div>

    <!-- êµ½ê¸° ê²Œì´ì§€ (Doneness Bar) -->
    <div class="doneness-bar">
        <div id="doneness-fill" class="doneness-fill"></div>
    </div>
    <p class="text-sm text-gray-500 mt-1 text-center"><span id="doneness-label">Rare (0%)</span></p>

    <!-- ê²Œì„ ë©”ì‹œì§€ ì¶œë ¥ ì˜ì—­ -->
    <div id="game-message" class="mt-4 p-3 bg-yellow-100 text-yellow-800 rounded-lg hidden font-medium text-center"></div>

    <!-- ì»¨íŠ¸ë¡¤ ë²„íŠ¼ -->
    <div class="flex justify-center space-x-4 mt-8">
        <button id="grill-btn" class="bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-6 rounded-xl shadow-lg transition-all text-lg">
            ğŸ”¥ êµ½ê¸° ì‹œì‘ / ë’¤ì§‘ê¸° ğŸ”¥
        </button>
        <button id="serve-btn" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-6 rounded-xl shadow-lg transition-all text-lg" disabled>
            ğŸ½ï¸ ì†ë‹˜ì—ê²Œ ì„œë¹™ ğŸ½ï¸
        </button>
    </div>

    <!-- ê²°ê³¼ ëª¨ë‹¬ (ë¼ìš´ë“œ ì¢…ë£Œ ì‹œ í‘œì‹œ) -->
    <div id="result-modal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-75 flex justify-center items-center p-4">
        <div class="bg-white p-6 rounded-xl w-full max-w-sm text-center shadow-2xl">
            <h2 id="result-title" class="text-2xl font-bold mb-4 text-red-600"></h2>
            <p id="result-details" class="text-gray-700 mb-4"></p>
            <p class="text-2xl font-extrabold text-green-600">íšë“ ì ìˆ˜: <span id="round-score"></span></p>
            <p class="text-lg font-bold text-gray-800 mt-2">ëˆ„ì  ì ìˆ˜: <span id="final-total-score"></span></p>
            <button id="next-round-btn" class="mt-6 bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded-xl">
                ë‹¤ìŒ ì†ë‹˜ ë§ì´í•˜ê¸° (ìƒˆ ë¼ìš´ë“œ)
            </button>
        </div>
    </div>
</div>

<script>
    // -----------------------------------------------------------------
    // Apps Script API í˜¸ì¶œ (GAS Web App í™˜ê²½ì—ì„œë§Œ ì‘ë™)
    // -----------------------------------------------------------------
    // GAS ì„œë²„ ìŠ¤í¬ë¦½íŠ¸ì˜ saveScore í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•  ì¤€ë¹„
    const saveScore = (score) => {
        // google.script.runì€ í´ë¼ì´ì–¸íŠ¸ì—ì„œ ì„œë²„ í•¨ìˆ˜ë¥¼ ë¹„ë™ê¸°ì ìœ¼ë¡œ í˜¸ì¶œí•˜ëŠ” GAS ê¸°ëŠ¥ì…ë‹ˆë‹¤.
        if (typeof google !== 'undefined' && google.script && google.script.run) {
            google.script.run
                .withSuccessHandler(res => console.log('Score saved:', res.message))
                .withFailureHandler(err => console.error('Score save failed:', err))
                .saveScore(score);
        } else {
            console.warn("GAS í™˜ê²½ì´ ì•„ë‹™ë‹ˆë‹¤. ì„œë²„ í•¨ìˆ˜ í˜¸ì¶œì„ ê±´ë„ˆëœë‹ˆë‹¤.");
        }
    };

    // -----------------------------------------------------------------
    // ê²Œì„ ì„¤ì • ë° ë³€ìˆ˜
    // -----------------------------------------------------------------

    // êµ½ê¸° ì •ë„(Doneness) ë ˆë²¨ ì •ì˜
    const DONENESS_LEVELS = [
        { name: "Rare (ë ˆì–´)", min: 0, max: 20, color: '#f87171' },
        { name: "Medium Rare (ë¯¸ë””ì›€ ë ˆì–´)", min: 20, max: 40, color: '#f97316' },
        { name: "Medium (ë¯¸ë””ì›€)", min: 40, max: 60, color: '#f59e0b' },
        { name: "Medium Well (ë¯¸ë””ì›€ ì›°)", min: 60, max: 80, color: '#10b981' },
        { name: "Well Done (ì›°ë˜)", min: 80, max: 100, color: '#1d4ed8' }
    ];

    let gameState = {
        totalScore: 0,
        targetDoneness: 0, // ëª©í‘œ êµ½ê¸° % (0-100)
        targetLevel: null,  // ëª©í‘œ êµ½ê¸° ë ˆë²¨ ê°ì²´
        currentDoneness: 0, // í˜„ì¬ êµ½ê¸° % (0-100)
        isGrilling: false, // í˜„ì¬ êµ½ëŠ” ì¤‘ì¸ì§€ ì—¬ë¶€
        grillInterval: null, // êµ½ê¸° íƒ€ì´ë¨¸ ID
        flipCount: 0, // ê³ ê¸° ë’¤ì§‘ê¸° íšŸìˆ˜ (êµ½ê¸° ì†ë„ì— ì˜í–¥)
        isFlipped: false // ê³ ê¸° ì•„ì´ì½˜ ë’¤ì§‘ê¸° ìƒíƒœ
    };

    // -----------------------------------------------------------------
    // DOM ìš”ì†Œ ìºì‹œ (ì„±ëŠ¥ ìµœì í™”)
    // -----------------------------------------------------------------

    const $ = (id) => document.getElementById(id);

    const elements = {
        targetDoneness: $('target-doneness'),
        currentScore: $('current-score'),
        donenessFill: $('doneness-fill'),
        donenessLabel: $('doneness-label'),
        grillBtn: $('grill-btn'),
        serveBtn: $('serve-btn'),
        meat: $('meat'),
        gameMessage: $('game-message'),
        resultModal: $('result-modal'),
        resultTitle: $('result-title'),
        resultDetails: $('result-details'),
        roundScore: $('round-score'),
        finalTotalScore: $('final-total-score'),
        nextRoundBtn: $('next-round-btn')
    };

    // -----------------------------------------------------------------
    // ê²Œì„ ë¡œì§ í•¨ìˆ˜
    // -----------------------------------------------------------------

    /**
     * í˜„ì¬ êµ½ê¸° %ì— í•´ë‹¹í•˜ëŠ” Doneness Level ê°ì²´ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.
     * @param {number} doneness - í˜„ì¬ êµ½ê¸° % (0-100)
     * @returns {Object} - Doneness Level ê°ì²´
     */
    function getCurrentLevel(doneness) {
        // ìµœëŒ€ ë ˆë²¨(Well Done)ì„ ì´ˆê³¼í•˜ëŠ” ê²½ìš°ë¥¼ ì²˜ë¦¬í•˜ê¸° ìœ„í•´ ì—­ìˆœìœ¼ë¡œ ì°¾ìŠµë‹ˆë‹¤.
        for (let i = DONENESS_LEVELS.length - 1; i >= 0; i--) {
            const level = DONENESS_LEVELS[i];
            if (doneness >= level.min) {
                return level;
            }
        }
        return DONENESS_LEVELS[0]; // 0% ë¯¸ë§Œì€ Rare
    }

    /**
     * UIë¥¼ í˜„ì¬ ê²Œì„ ìƒíƒœì— ë§ê²Œ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤.
     */
    function updateUI() {
        const fill = elements.donenessFill;
        const meat = elements.meat;
        const currentLevel = getCurrentLevel(gameState.currentDoneness);

        // êµ½ê¸° ê²Œì´ì§€ ì—…ë°ì´íŠ¸
        fill.style.width = `${gameState.currentDoneness}%`;
        fill.style.backgroundColor = currentLevel.color;
        elements.donenessLabel.textContent = `${currentLevel.name} (${Math.round(gameState.currentDoneness)}%)`;

        // ê³ ê¸° ìƒ‰ìƒ ì—…ë°ì´íŠ¸ (ì ì  ì–´ë‘ì›Œì§€ê²Œ)
        const cookRatio = gameState.currentDoneness / 100;
        // RGB ìƒ‰ìƒ ë³´ê°„ (A0522D -> 502814)
        const initialR = 160, initialG = 82, initialB = 45; 
        const finalR = 80, finalG = 40, finalB = 20; 

        const r = Math.round(initialR - (initialR - finalR) * cookRatio);
        const g = Math.round(initialG - (initialG - finalG) * cookRatio);
        const b = Math.round(initialB - (initialB - finalB) * cookRatio);
        
        meat.style.backgroundColor = `rgb(${r}, ${g}, ${b})`;
        meat.style.opacity = 0.8 + (cookRatio * 0.2); // êµ¬ìš¸ìˆ˜ë¡ ì§™ì–´ì§€ê²Œ

        // ê³ ê¸° ë’¤ì§‘ê¸° ìƒíƒœ ë°˜ì˜
        if (gameState.isFlipped) {
            meat.classList.add('flipped');
        } else {
            meat.classList.remove('flipped');
        }

        // ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
        elements.serveBtn.disabled = !gameState.isGrilling;
        elements.grillBtn.textContent = gameState.isGrilling ? 'ğŸ”¥ ë’¤ì§‘ê¸° ğŸ”¥' : 'ğŸ”¥ êµ½ê¸° ğŸ”¥';
    }

    /**
     * êµ½ê¸° ì§„í–‰ ë£¨í”„ì…ë‹ˆë‹¤. 100msë§ˆë‹¤ ì‹¤í–‰ë©ë‹ˆë‹¤.
     */
    function grillStep() {
        if (!gameState.isGrilling) return;

        // êµ½ê¸° ì†ë„ ê³„ì‚° ë¡œì§: êµ½ê¸° ì •ë„ì— ë”°ë¼ ì†ë„ê°€ ë³€í•˜ê³ , ë’¤ì§‘ê¸° íšŸìˆ˜ì— ë”°ë¼ ê°€ì†ë©ë‹ˆë‹¤.
        const baseSpeed = 0.5; // ê¸°ë³¸ ì†ë„ (%/100ms)
        const slowDownFactor = 0.4 * (gameState.currentDoneness / 100); // êµ½ê¸° ì •ë„ì— ë”°ë¥¸ ë‘”í™”
        const flipBoost = 0.1 * gameState.flipCount; // ë’¤ì§‘ê¸°ì— ë”°ë¥¸ ê°€ì†
        const speed = Math.max(0.1, baseSpeed - slowDownFactor + flipBoost);

        gameState.currentDoneness += speed;

        // 100% ì´ˆê³¼ ë°©ì§€ ë° ìë™ ì„œë¹™ (íƒ„ ê³ ê¸° ì²˜ë¦¬)
        if (gameState.currentDoneness >= 100) {
            gameState.currentDoneness = 100;
            stopGrill();
            showMessage("ê³ ê¸°ê°€ ë‹¤ íƒ€ë²„ë ¸ì–´ìš”! (Well Done ì´ˆê³¼)", 'bg-red-200 text-red-900');
            serveMeat();
        }

        updateUI();
    }

    /**
     * ê²Œì„ ì‹œì‘/ë’¤ì§‘ê¸° ë²„íŠ¼ í•¸ë“¤ëŸ¬
     */
    function handleGrillAction() {
        if (!gameState.isGrilling) {
            // êµ½ê¸° ì‹œì‘
            gameState.isGrilling = true;
            gameState.grillInterval = setInterval(grillStep, 100); // 0.1ì´ˆë§ˆë‹¤ êµ½ê¸° ì§„í–‰
            showMessage("ê³ ê¸° êµ½ê¸° ì‹œì‘!", 'bg-green-200 text-green-900');
        } else {
            // ë’¤ì§‘ê¸°
            gameState.flipCount++;
            gameState.isFlipped = !gameState.isFlipped; // ë’¤ì§‘ê¸° ìƒíƒœ í† ê¸€
            showMessage(`ê³ ê¸°ë¥¼ ë’¤ì§‘ì—ˆìŠµë‹ˆë‹¤! (ë’¤ì§‘ê¸° ${gameState.flipCount}íšŒ)`, 'bg-blue-200 text-blue-900');
        }
        updateUI();
    }

    /**
     * êµ½ê¸° ì¤‘ì§€
     */
    function stopGrill() {
        if (gameState.grillInterval) {
            clearInterval(gameState.grillInterval);
            gameState.grillInterval = null;
            gameState.isGrilling = false;
        }
    }

    /**
     * ì„œë¹™ ë° ì ìˆ˜ ê³„ì‚°
     */
    function serveMeat() {
        // êµ½ê¸° ì‹œì‘ ì „ì—ëŠ” ì„œë¹™ ë¶ˆê°€ (ì˜¤ë¥˜ ë°©ì§€)
        if (!gameState.isGrilling && gameState.flipCount === 0) return; 

        stopGrill();

        const actualDoneness = gameState.currentDoneness;
        const targetDoneness = gameState.targetDoneness;
        const targetLevel = gameState.targetLevel;

        // ì˜¤ì°¨ ê³„ì‚°: ëª©í‘œì¹˜ì™€ ì‹¤ì œ êµ½ê¸° ì •ë„ì˜ ì°¨ì´
        const error = Math.abs(actualDoneness - targetDoneness);

        // ì ìˆ˜ ê³„ì‚° (ìµœëŒ€ 100ì ): ì˜¤ì°¨ê°€ 0ì´ë©´ 100ì , ì˜¤ì°¨ê°€ 100ì´ë©´ 0ì 
        const roundScore = Math.max(0, Math.round(100 - error));

        gameState.totalScore += roundScore;

        // ê²°ê³¼ ëª¨ë‹¬ í‘œì‹œ
        elements.resultTitle.textContent = roundScore >= 95 ? 'ğŸ‘‘ ì™„ë²½í•œ ë§ˆìŠ¤í„°! ğŸ‘‘' : roundScore >= 90 ? 'â­â­ ìµœê³ ì˜ˆìš”! â­â­' : roundScore >= 70 ? 'ğŸ‘ ì˜ êµ¬ì› ì–´ìš”!' : 'ğŸ˜¢ ì•„ì‰¬ì›Œìš”...';
        elements.resultTitle.style.color = roundScore >= 90 ? '#ef4444' : '#f97316'; 

        elements.resultDetails.innerHTML = `
            <p class="font-bold">ì†ë‹˜ ìš”ì²­: <span class="text-blue-600">${targetLevel.name}</span> (${targetDoneness.toFixed(1)}%)</p>
            <p class="font-bold">ì‹¤ì œ êµ½ê¸°: <span class="text-green-600">${getCurrentLevel(actualDoneness).name}</span> (${actualDoneness.toFixed(1)}%)</p>
            <p><strong>ì˜¤ì°¨:</strong> ${error.toFixed(1)}%</p>
        `;
        elements.roundScore.textContent = roundScore;
        elements.finalTotalScore.textContent = gameState.totalScore;
        elements.resultModal.classList.remove('hidden');

        // ì„œë²„ì— ì ìˆ˜ ê¸°ë¡ (ì„ íƒ ì‚¬í•­ - Code.gsì˜ saveScore í•¨ìˆ˜ í˜¸ì¶œ)
        // saveScore(gameState.totalScore); 
    }

    /**
     * ìƒˆë¡œìš´ ë¼ìš´ë“œ (ì†ë‹˜) ì‹œì‘
     */
    function startNewRound() {
        // 1. ëª©í‘œ êµ½ê¸° ë ˆë²¨ì„ ë¬´ì‘ìœ„ë¡œ ì„ íƒ
        const levelIndex = Math.floor(Math.random() * DONENESS_LEVELS.length);
        gameState.targetLevel = DONENESS_LEVELS[levelIndex];

        // 2. ëª©í‘œ êµ½ê¸° % (ë ˆë²¨ ë²”ìœ„ ë‚´ì—ì„œ ë¬´ì‘ìœ„, ì¢€ ë” ì„¸ë°€í•œ ëª©í‘œì¹˜)
        const min = gameState.targetLevel.min;
        const max = gameState.targetLevel.max;
        gameState.targetDoneness = Math.random() * (max - min) + min;

        // 3. ê²Œì„ ìƒíƒœ ì´ˆê¸°í™”
        gameState.currentDoneness = 0;
        gameState.isGrilling = false;
        gameState.flipCount = 0;
        gameState.isFlipped = false;
        stopGrill(); 

        // 4. UI ì—…ë°ì´íŠ¸
        elements.targetDoneness.textContent = gameState.targetLevel.name;
        elements.currentScore.textContent = gameState.totalScore;
        elements.resultModal.classList.add('hidden');
        elements.gameMessage.classList.add('hidden');
        elements.meat.textContent = 'ğŸ¥©';
        elements.meat.classList.remove('flipped'); 

        // 5. ì´ˆê¸° UI ë Œë”ë§
        updateUI();

        showMessage("ìƒˆ ì†ë‹˜ì´ ì™”ìŠµë‹ˆë‹¤! ê³ ê¸°ë¥¼ ì˜¬ë ¤ì£¼ì„¸ìš”.", 'bg-blue-100 text-blue-800');
    }

    /**
     * í™”ë©´ì— ë©”ì‹œì§€ë¥¼ í‘œì‹œí•©ë‹ˆë‹¤.
     */
    function showMessage(text, className) {
        const msg = elements.gameMessage;
        msg.textContent = text;
        msg.className = `mt-4 p-3 rounded-lg font-medium text-center ${className}`;
        msg.classList.remove('hidden');
    }


    // -----------------------------------------------------------------
    // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
    // -----------------------------------------------------------------

    elements.grillBtn.addEventListener('click', handleGrillAction);
    elements.serveBtn.addEventListener('click', serveMeat);
    elements.nextRoundBtn.addEventListener('click', startNewRound);

    // -----------------------------------------------------------------
    // ê²Œì„ ì´ˆê¸°í™”
    // -----------------------------------------------------------------
    // í˜ì´ì§€ ë¡œë“œ ì‹œ ì²« ë¼ìš´ë“œë¥¼ ì‹œì‘í•©ë‹ˆë‹¤.
    startNewRound();

</script>
</body>
</html>
